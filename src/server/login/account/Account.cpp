/*
 *	server/login/account/Account.cpp generated by engine3 IDL compiler 0.60
 */

#include "Account.h"

#include "server/login/account/AccountManager.h"

#include "server/zone/ZoneClientSession.h"


// Imported class dependencies

#include "engine/core/ManagedObject.h"

#include "engine/core/ObjectUpdateToDatabaseTask.h"

#include "engine/service/proto/BaseClientProxy.h"

#include "engine/service/proto/BasePacket.h"

#include "server/login/account/Account.h"

#include "server/login/account/AccountManager.h"

#include "server/zone/ZoneClientSession.h"

#include "server/zone/objects/scene/SceneObject.h"

#include "system/io/ObjectInputStream.h"

#include "system/io/ObjectOutputStream.h"

#include "system/util/VectorMap.h"

/*
 *	AccountStub
 */

enum {RPC_HASMAXONLINECHARACTERS__ = 6,RPC_GETZONESESSION__INT_,RPC_CONTAINSZONESESSION__INT_,RPC_ADDZONESESSION__ZONECLIENTSESSION_,RPC_REMOVEZONESESSION__INT_,RPC_SETACCOUNTID__INT_,RPC_SETSTATIONID__INT_,RPC_SETADMINLEVEL__INT_,RPC_SETUSERNAME__STRING_,RPC_SETTIMECREATED__INT_,RPC_GETACCOUNTID__,RPC_GETSTATIONID__,RPC_GETADMINLEVEL__,RPC_GETUSERNAME__,RPC_GETTIMECREATED__};

Account::Account(AccountManager* accManage, const String& usern, unsigned int accountid, unsigned int stationid) : ManagedObject(DummyConstructorParameter::instance()) {
	AccountImplementation* _implementation = new AccountImplementation(accManage, usern, accountid, stationid);
	ManagedObject::_setImplementation(_implementation);
	_implementation->_setStub(this);
}

Account::Account(DummyConstructorParameter* param) : ManagedObject(param) {
}

Account::~Account() {
}


bool Account::hasMaxOnlineCharacters() {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_HASMAXONLINECHARACTERS__);

		return method.executeWithBooleanReturn();
	} else
		return _implementation->hasMaxOnlineCharacters();
}

ZoneClientSession* Account::getZoneSession(unsigned int sessionID) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_GETZONESESSION__INT_);
		method.addUnsignedIntParameter(sessionID);

		return (ZoneClientSession*) method.executeWithObjectReturn();
	} else
		return _implementation->getZoneSession(sessionID);
}

bool Account::containsZoneSession(unsigned int sessionID) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_CONTAINSZONESESSION__INT_);
		method.addUnsignedIntParameter(sessionID);

		return method.executeWithBooleanReturn();
	} else
		return _implementation->containsZoneSession(sessionID);
}

void Account::addZoneSession(ZoneClientSession* client) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_ADDZONESESSION__ZONECLIENTSESSION_);
		method.addObjectParameter(client);

		method.executeWithVoidReturn();
	} else
		_implementation->addZoneSession(client);
}

void Account::removeZoneSession(unsigned int sessionID) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_REMOVEZONESESSION__INT_);
		method.addUnsignedIntParameter(sessionID);

		method.executeWithVoidReturn();
	} else
		_implementation->removeZoneSession(sessionID);
}

void Account::setAccountID(unsigned int accountid) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_SETACCOUNTID__INT_);
		method.addUnsignedIntParameter(accountid);

		method.executeWithVoidReturn();
	} else
		_implementation->setAccountID(accountid);
}

void Account::setStationID(unsigned int stationid) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_SETSTATIONID__INT_);
		method.addUnsignedIntParameter(stationid);

		method.executeWithVoidReturn();
	} else
		_implementation->setStationID(stationid);
}

void Account::setAdminLevel(unsigned int adminlvl) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_SETADMINLEVEL__INT_);
		method.addUnsignedIntParameter(adminlvl);

		method.executeWithVoidReturn();
	} else
		_implementation->setAdminLevel(adminlvl);
}

void Account::setUsername(const String& usern) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_SETUSERNAME__STRING_);
		method.addAsciiParameter(usern);

		method.executeWithVoidReturn();
	} else
		_implementation->setUsername(usern);
}

void Account::setTimeCreated(unsigned int seconds) {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_SETTIMECREATED__INT_);
		method.addUnsignedIntParameter(seconds);

		method.executeWithVoidReturn();
	} else
		_implementation->setTimeCreated(seconds);
}

unsigned int Account::getAccountID() {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_GETACCOUNTID__);

		return method.executeWithUnsignedIntReturn();
	} else
		return _implementation->getAccountID();
}

unsigned int Account::getStationID() {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_GETSTATIONID__);

		return method.executeWithUnsignedIntReturn();
	} else
		return _implementation->getStationID();
}

unsigned int Account::getAdminLevel() {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_GETADMINLEVEL__);

		return method.executeWithUnsignedIntReturn();
	} else
		return _implementation->getAdminLevel();
}

String Account::getUsername() {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_GETUSERNAME__);

		method.executeWithAsciiReturn(_return_getUsername);
		return _return_getUsername;
	} else
		return _implementation->getUsername();
}

unsigned int Account::getTimeCreated() {
	AccountImplementation* _implementation = (AccountImplementation*) _getImplementation();
	if (_implementation == NULL) {
		if (!deployed)
			throw ObjectNotDeployedException(this);

		DistributedMethod method(this, RPC_GETTIMECREATED__);

		return method.executeWithUnsignedIntReturn();
	} else
		return _implementation->getTimeCreated();
}

DistributedObjectServant* Account::_getImplementation() {

	_updated = true;
	return dynamic_cast<DistributedObjectServant*>(getForUpdate());}

void Account::_setImplementation(DistributedObjectServant* servant) {
	setObject(dynamic_cast<AccountImplementation*>(servant));
}

/*
 *	AccountImplementation
 */

AccountImplementation::AccountImplementation(DummyConstructorParameter* param) : ManagedObjectImplementation(param) {
	_initializeImplementation();
}


AccountImplementation::~AccountImplementation() {
}


void AccountImplementation::finalize() {
}

void AccountImplementation::_initializeImplementation() {
	_setClassHelper(AccountHelper::instance());

	_serializationHelperMethod();
	_serializationHelperMethod();
}

void AccountImplementation::_setStub(DistributedObjectStub* stub) {
	_this = (Account*) stub;
	ManagedObjectImplementation::_setStub(stub);
}

DistributedObjectStub* AccountImplementation::_getStub() {
	return _this;
}

AccountImplementation::operator const Account*() {
	return _this;
}

Object* AccountImplementation::clone() {
	return dynamic_cast<Object*>(new AccountImplementation(*this));
}


void AccountImplementation::lock(bool doLock) {
}

void AccountImplementation::lock(ManagedObject* obj) {
}

void AccountImplementation::rlock(bool doLock) {
}

void AccountImplementation::wlock(bool doLock) {
}

void AccountImplementation::wlock(ManagedObject* obj) {
}

void AccountImplementation::unlock(bool doLock) {
}

void AccountImplementation::runlock(bool doLock) {
}

void AccountImplementation::_serializationHelperMethod() {
	ManagedObjectImplementation::_serializationHelperMethod();

	_setClassName("Account");

}

void AccountImplementation::readObject(ObjectInputStream* stream) {
	uint16 _varCount = stream->readShort();
	for (int i = 0; i < _varCount; ++i) {
		String _name;
		_name.parseFromBinaryStream(stream);

		uint16 _varSize = stream->readShort();

		int _currentOffset = stream->getOffset();

		if(AccountImplementation::readObjectMember(stream, _name)) {
		}

		stream->setOffset(_currentOffset + _varSize);
	}

	initializeTransientMembers();
}

bool AccountImplementation::readObjectMember(ObjectInputStream* stream, const String& _name) {
	if (ManagedObjectImplementation::readObjectMember(stream, _name))
		return true;

	if (_name == "zoneSessions") {
		TypeInfo<VectorMap<unsigned int, ManagedReference<ZoneClientSession* > > >::parseFromBinaryStream(&zoneSessions, stream);
		return true;
	}

	if (_name == "username") {
		TypeInfo<String >::parseFromBinaryStream(&username, stream);
		return true;
	}

	if (_name == "accountID") {
		TypeInfo<unsigned int >::parseFromBinaryStream(&accountID, stream);
		return true;
	}

	if (_name == "stationID") {
		TypeInfo<unsigned int >::parseFromBinaryStream(&stationID, stream);
		return true;
	}

	if (_name == "adminLevel") {
		TypeInfo<unsigned int >::parseFromBinaryStream(&adminLevel, stream);
		return true;
	}

	if (_name == "created") {
		TypeInfo<unsigned int >::parseFromBinaryStream(&created, stream);
		return true;
	}


	return false;
}

void AccountImplementation::writeObject(ObjectOutputStream* stream) {
	int _currentOffset = stream->getOffset();
	stream->writeShort(0);
	int _varCount = AccountImplementation::writeObjectMembers(stream);
	stream->writeShort(_currentOffset, _varCount);
}

int AccountImplementation::writeObjectMembers(ObjectOutputStream* stream) {
	String _name;
	int _offset;
	uint16 _totalSize;
	_name = "zoneSessions";
	_name.toBinaryStream(stream);
	_offset = stream->getOffset();
	stream->writeShort(0);
	TypeInfo<VectorMap<unsigned int, ManagedReference<ZoneClientSession* > > >::toBinaryStream(&zoneSessions, stream);
	_totalSize = (uint16) (stream->getOffset() - (_offset + 2));
	stream->writeShort(_offset, _totalSize);

	_name = "username";
	_name.toBinaryStream(stream);
	_offset = stream->getOffset();
	stream->writeShort(0);
	TypeInfo<String >::toBinaryStream(&username, stream);
	_totalSize = (uint16) (stream->getOffset() - (_offset + 2));
	stream->writeShort(_offset, _totalSize);

	_name = "accountID";
	_name.toBinaryStream(stream);
	_offset = stream->getOffset();
	stream->writeShort(0);
	TypeInfo<unsigned int >::toBinaryStream(&accountID, stream);
	_totalSize = (uint16) (stream->getOffset() - (_offset + 2));
	stream->writeShort(_offset, _totalSize);

	_name = "stationID";
	_name.toBinaryStream(stream);
	_offset = stream->getOffset();
	stream->writeShort(0);
	TypeInfo<unsigned int >::toBinaryStream(&stationID, stream);
	_totalSize = (uint16) (stream->getOffset() - (_offset + 2));
	stream->writeShort(_offset, _totalSize);

	_name = "adminLevel";
	_name.toBinaryStream(stream);
	_offset = stream->getOffset();
	stream->writeShort(0);
	TypeInfo<unsigned int >::toBinaryStream(&adminLevel, stream);
	_totalSize = (uint16) (stream->getOffset() - (_offset + 2));
	stream->writeShort(_offset, _totalSize);

	_name = "created";
	_name.toBinaryStream(stream);
	_offset = stream->getOffset();
	stream->writeShort(0);
	TypeInfo<unsigned int >::toBinaryStream(&created, stream);
	_totalSize = (uint16) (stream->getOffset() - (_offset + 2));
	stream->writeShort(_offset, _totalSize);


	return 6 + ManagedObjectImplementation::writeObjectMembers(stream);
}

AccountImplementation::AccountImplementation(AccountManager* accManage, const String& usern, unsigned int accountid, unsigned int stationid) {
	_initializeImplementation();
	// server/login/account/Account.idl():  		username = usern;
	username = usern;
	// server/login/account/Account.idl():  		accountID = accountid;
	accountID = accountid;
	// server/login/account/Account.idl():  		stationID = stationid;
	stationID = stationid;
	// server/login/account/Account.idl():  		accountManager = accManage;
	accountManager = accManage;
	// server/login/account/Account.idl():  		adminLevel = 0;
	adminLevel = 0;
	// server/login/account/Account.idl():  		created = System.getTime();
	created = System::getTime();
	// server/login/account/Account.idl():  		zoneSessions.setInsertPlan(2);
	(&zoneSessions)->setInsertPlan(2);
	// server/login/account/Account.idl():  		zoneSessions.setNullValue(null);
	(&zoneSessions)->setNullValue(NULL);
}

bool AccountImplementation::hasMaxOnlineCharacters() {
	// server/login/account/Account.idl():  		return zoneSessions.size() + 1 > accountManager.getMaxOnlineCharacters();
	return (&zoneSessions)->size() + 1 > accountManager->getMaxOnlineCharacters();
}

ZoneClientSession* AccountImplementation::getZoneSession(unsigned int sessionID) {
	// server/login/account/Account.idl():  		return zoneSessions.get(sessionID);
	return (&zoneSessions)->get(sessionID);
}

bool AccountImplementation::containsZoneSession(unsigned int sessionID) {
	// server/login/account/Account.idl():  		return zoneSessions.contains(sessionID);
	return (&zoneSessions)->contains(sessionID);
}

void AccountImplementation::addZoneSession(ZoneClientSession* client) {
	// server/login/account/Account.idl():  		zoneSessions.put(client.getSessionID(), client);
	(&zoneSessions)->put(client->getSessionID(), client);
}

void AccountImplementation::removeZoneSession(unsigned int sessionID) {
	// server/login/account/Account.idl():  		zoneSessions.drop(sessionID);
	(&zoneSessions)->drop(sessionID);
	// server/login/account/Account.idl():  	}
	if ((&zoneSessions)->size() < 1)	// server/login/account/Account.idl():  			accountManager.dropAccount(accountID);
	accountManager->dropAccount(accountID);
}

void AccountImplementation::setAccountID(unsigned int accountid) {
	// server/login/account/Account.idl():  		accountID = accountid;
	accountID = accountid;
}

void AccountImplementation::setStationID(unsigned int stationid) {
	// server/login/account/Account.idl():  		stationID = stationid;
	stationID = stationid;
}

void AccountImplementation::setAdminLevel(unsigned int adminlvl) {
	// server/login/account/Account.idl():  		adminLevel = adminlvl;
	adminLevel = adminlvl;
}

void AccountImplementation::setUsername(const String& usern) {
	// server/login/account/Account.idl():  		username = usern;
	username = usern;
}

void AccountImplementation::setTimeCreated(unsigned int seconds) {
	// server/login/account/Account.idl():  		created = seconds;
	created = seconds;
}

unsigned int AccountImplementation::getAccountID() {
	// server/login/account/Account.idl():  		return accountID;
	return accountID;
}

unsigned int AccountImplementation::getStationID() {
	// server/login/account/Account.idl():  		return stationID;
	return stationID;
}

unsigned int AccountImplementation::getAdminLevel() {
	// server/login/account/Account.idl():  		return adminLevel;
	return adminLevel;
}

String AccountImplementation::getUsername() {
	// server/login/account/Account.idl():  		return username;
	return username;
}

unsigned int AccountImplementation::getTimeCreated() {
	// server/login/account/Account.idl():  		return created;
	return created;
}

/*
 *	AccountAdapter
 */

AccountAdapter::AccountAdapter(AccountImplementation* obj) : ManagedObjectAdapter(obj) {
}

Packet* AccountAdapter::invokeMethod(uint32 methid, DistributedMethod* inv) {
	Packet* resp = new MethodReturnMessage(0);

	switch (methid) {
	case RPC_HASMAXONLINECHARACTERS__:
		resp->insertBoolean(hasMaxOnlineCharacters());
		break;
	case RPC_GETZONESESSION__INT_:
		resp->insertLong(getZoneSession(inv->getUnsignedIntParameter())->_getObjectID());
		break;
	case RPC_CONTAINSZONESESSION__INT_:
		resp->insertBoolean(containsZoneSession(inv->getUnsignedIntParameter()));
		break;
	case RPC_ADDZONESESSION__ZONECLIENTSESSION_:
		addZoneSession((ZoneClientSession*) inv->getObjectParameter());
		break;
	case RPC_REMOVEZONESESSION__INT_:
		removeZoneSession(inv->getUnsignedIntParameter());
		break;
	case RPC_SETACCOUNTID__INT_:
		setAccountID(inv->getUnsignedIntParameter());
		break;
	case RPC_SETSTATIONID__INT_:
		setStationID(inv->getUnsignedIntParameter());
		break;
	case RPC_SETADMINLEVEL__INT_:
		setAdminLevel(inv->getUnsignedIntParameter());
		break;
	case RPC_SETUSERNAME__STRING_:
		setUsername(inv->getAsciiParameter(_param0_setUsername__String_));
		break;
	case RPC_SETTIMECREATED__INT_:
		setTimeCreated(inv->getUnsignedIntParameter());
		break;
	case RPC_GETACCOUNTID__:
		resp->insertInt(getAccountID());
		break;
	case RPC_GETSTATIONID__:
		resp->insertInt(getStationID());
		break;
	case RPC_GETADMINLEVEL__:
		resp->insertInt(getAdminLevel());
		break;
	case RPC_GETUSERNAME__:
		resp->insertAscii(getUsername());
		break;
	case RPC_GETTIMECREATED__:
		resp->insertInt(getTimeCreated());
		break;
	default:
		return NULL;
	}

	return resp;
}

bool AccountAdapter::hasMaxOnlineCharacters() {
	return ((AccountImplementation*) impl)->hasMaxOnlineCharacters();
}

ZoneClientSession* AccountAdapter::getZoneSession(unsigned int sessionID) {
	return ((AccountImplementation*) impl)->getZoneSession(sessionID);
}

bool AccountAdapter::containsZoneSession(unsigned int sessionID) {
	return ((AccountImplementation*) impl)->containsZoneSession(sessionID);
}

void AccountAdapter::addZoneSession(ZoneClientSession* client) {
	((AccountImplementation*) impl)->addZoneSession(client);
}

void AccountAdapter::removeZoneSession(unsigned int sessionID) {
	((AccountImplementation*) impl)->removeZoneSession(sessionID);
}

void AccountAdapter::setAccountID(unsigned int accountid) {
	((AccountImplementation*) impl)->setAccountID(accountid);
}

void AccountAdapter::setStationID(unsigned int stationid) {
	((AccountImplementation*) impl)->setStationID(stationid);
}

void AccountAdapter::setAdminLevel(unsigned int adminlvl) {
	((AccountImplementation*) impl)->setAdminLevel(adminlvl);
}

void AccountAdapter::setUsername(const String& usern) {
	((AccountImplementation*) impl)->setUsername(usern);
}

void AccountAdapter::setTimeCreated(unsigned int seconds) {
	((AccountImplementation*) impl)->setTimeCreated(seconds);
}

unsigned int AccountAdapter::getAccountID() {
	return ((AccountImplementation*) impl)->getAccountID();
}

unsigned int AccountAdapter::getStationID() {
	return ((AccountImplementation*) impl)->getStationID();
}

unsigned int AccountAdapter::getAdminLevel() {
	return ((AccountImplementation*) impl)->getAdminLevel();
}

String AccountAdapter::getUsername() {
	return ((AccountImplementation*) impl)->getUsername();
}

unsigned int AccountAdapter::getTimeCreated() {
	return ((AccountImplementation*) impl)->getTimeCreated();
}

/*
 *	AccountHelper
 */

AccountHelper* AccountHelper::staticInitializer = AccountHelper::instance();

AccountHelper::AccountHelper() {
	className = "Account";

	Core::getObjectBroker()->registerClass(className, this);
}

void AccountHelper::finalizeHelper() {
	AccountHelper::finalize();
}

DistributedObject* AccountHelper::instantiateObject() {
	return new Account(DummyConstructorParameter::instance());
}

DistributedObjectServant* AccountHelper::instantiateServant() {
	return new AccountImplementation(DummyConstructorParameter::instance());
}

DistributedObjectAdapter* AccountHelper::createAdapter(DistributedObjectStub* obj) {
	DistributedObjectAdapter* adapter = new AccountAdapter((AccountImplementation*) obj->_getImplementation());

	obj->_setClassName(className);
	obj->_setClassHelper(this);

	adapter->setStub(obj);

	return adapter;
}

